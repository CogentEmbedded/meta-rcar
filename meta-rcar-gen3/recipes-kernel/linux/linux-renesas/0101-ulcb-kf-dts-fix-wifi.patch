From 213af8f6c54bfb9ce5ab125fc39091588b8db303 Mon Sep 17 00:00:00 2001
From: Andrey Gusakov <andrey.gusakov@cogentembedded.com>
Date: Mon, 27 Mar 2017 16:18:13 +0300
Subject: [PATCH 101/104] ulcb-kf: dts: fix wifi


Signed-off-by: Andrey Gusakov <andrey.gusakov@cogentembedded.com>
---
 arch/arm64/boot/dts/renesas/r8a7795-h3ulcb-kf.dts |   17 +++++++++++++++--
 arch/arm64/boot/dts/renesas/r8a7796-m3ulcb-kf.dts |   17 +++++++++++++++--
 2 files changed, 30 insertions(+), 4 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r8a7795-h3ulcb-kf.dts b/arch/arm64/boot/dts/renesas/r8a7795-h3ulcb-kf.dts
index 9372bd6..1828985 100644
--- a/arch/arm64/boot/dts/renesas/r8a7795-h3ulcb-kf.dts
+++ b/arch/arm64/boot/dts/renesas/r8a7795-h3ulcb-kf.dts
@@ -175,8 +175,8 @@
 		compatible = "regulator-fixed";
 		regulator-name = "wlan-en-regulator";
 
-		regulator-min-microvolt = <1800000>;
-		regulator-max-microvolt = <1800000>;
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
 
 		gpio = <&gpio_ext_20 4 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
@@ -186,6 +186,7 @@
 		compatible = "regulator-fixed";
 
 		regulator-name = "SDHI3 VccQ";
+		/* external voltage translator to 1.8V */
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
 	};
@@ -694,6 +695,16 @@
 		input;
 		line-name = "touch irq";
 	};
+
+	/* From TI forum */
+	/* BT_AUD_OUT should be pulled low when WL_EN is activated. */
+	/* in case it isn't, wilink8 ends up in one of the test modes that introduces various issues */
+	bt_strap {
+		gpio-hog;
+		gpios = <14 GPIO_ACTIVE_HIGH>;
+		output-low;
+		line-name = "BT strap pin";
+	};
 };
 
 &gpio7 {
@@ -1802,8 +1813,10 @@
 	keep-power-in-suspend;
 	enable-sdio-wakeup;
 	bus-width = <4>;
+	no-1-8-v;
 	non-removable;
 	cap-power-off-card;
+	max-frequency = <26000000>;
 	status = "okay";
 
 	#address-cells = <1>;
diff --git a/arch/arm64/boot/dts/renesas/r8a7796-m3ulcb-kf.dts b/arch/arm64/boot/dts/renesas/r8a7796-m3ulcb-kf.dts
index 1461bab..a512ce9 100644
--- a/arch/arm64/boot/dts/renesas/r8a7796-m3ulcb-kf.dts
+++ b/arch/arm64/boot/dts/renesas/r8a7796-m3ulcb-kf.dts
@@ -165,8 +165,8 @@
 		compatible = "regulator-fixed";
 		regulator-name = "wlan-en-regulator";
 
-		regulator-min-microvolt = <1800000>;
-		regulator-max-microvolt = <1800000>;
+		regulator-min-microvolt = <3300000>;
+		regulator-max-microvolt = <3300000>;
 
 		gpio = <&gpio_ext_20 4 GPIO_ACTIVE_HIGH>;
 		enable-active-high;
@@ -176,6 +176,7 @@
 		compatible = "regulator-fixed";
 
 		regulator-name = "SDHI3 VccQ";
+		/* external voltage translator to 1.8V */
 		regulator-min-microvolt = <3300000>;
 		regulator-max-microvolt = <3300000>;
 	};
@@ -674,6 +675,16 @@
 		input;
 		line-name = "touch irq";
 	};
+
+	/* From TI forum */
+	/* BT_AUD_OUT should be pulled low when WL_EN is activated. */
+	/* in case it isn't, wilink8 ends up in one of the test modes that introduces various issues */
+	bt_strap {
+		gpio-hog;
+		gpios = <14 GPIO_ACTIVE_HIGH>;
+		output-low;
+		line-name = "BT strap pin";
+	};
 };
 
 &gpio7 {
@@ -1418,8 +1429,10 @@
 	keep-power-in-suspend;
 	enable-sdio-wakeup;
 	bus-width = <4>;
+	no-1-8-v;
 	non-removable;
 	cap-power-off-card;
+	max-frequency = <26000000>;
 	status = "okay";
 
 	#address-cells = <1>;
-- 
1.7.10.4

