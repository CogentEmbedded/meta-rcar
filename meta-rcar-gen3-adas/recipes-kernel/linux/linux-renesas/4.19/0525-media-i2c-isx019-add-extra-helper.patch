From 0111baed1e420afa8e30925d5097693c29ffb190 Mon Sep 17 00:00:00 2001
From: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
Date: Tue, 11 Aug 2020 12:27:35 +0300
Subject: [PATCH] media: i2c: isx019: add extra helper

This adds extra helper code

Signed-off-by: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
---
 drivers/media/i2c/soc_camera/isx019.c | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/drivers/media/i2c/soc_camera/isx019.c b/drivers/media/i2c/soc_camera/isx019.c
index d75d8f3..19efedc 100644
--- a/drivers/media/i2c/soc_camera/isx019.c
+++ b/drivers/media/i2c/soc_camera/isx019.c
@@ -461,12 +461,19 @@ static int isx019_initialize(struct i2c_client *client)
 	isx019_otp_id_read(client);
 	/* Program wizard registers */
 	isx019_set_regs(client, isx019_regs_wizard, ARRAY_SIZE(isx019_regs_wizard));
-	/* read resolution used by current firmware */
+#if 1
+	/* read resolution used by current firmware using VIF_COM (available only after valid stream started) */
 	isx019_read16(client, 86, 0x8, &val);
 	priv->max_width = val;
 	isx019_read16(client, 86, 0xa, &val);
 	priv->max_height = val;
-
+#else
+	/* read resolution used by current firmware using VIF */
+	isx019_read16(client, 85, 0x8, &val);
+	priv->max_width = val / 2;
+	isx019_read16(client, 85, 0xC, &val);
+	priv->max_height = val;
+#endif
 	dev_info(&client->dev, "isx019 PID %x (rev %x), res %dx%d, if=%s, OTP_ID %02x:%02x:%02x:%02x:%02x:%02x\n",
 		 pid & 0xff00, pid & 0xff, priv->max_width, priv->max_height, intf, priv->id[0], priv->id[1], priv->id[2], priv->id[3], priv->id[4], priv->id[5]);
 err:
-- 
2.7.4

