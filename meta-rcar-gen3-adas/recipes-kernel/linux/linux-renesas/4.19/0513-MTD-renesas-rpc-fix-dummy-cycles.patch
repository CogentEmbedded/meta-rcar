From 1a4e54a7ec2ae42a3481b95c187f2e3e19bc2989 Mon Sep 17 00:00:00 2001
From: Andrey Gusakov <andrey.gusakov@cogentembedded.com>
Date: Thu, 5 Dec 2019 17:30:15 +0300
Subject: [PATCH] MTD: renesas-rpc: fix dummy cycles

Signed-off-by: Andrey Gusakov <andrey.gusakov@cogentembedded.com>
---
 drivers/mtd/spi-nor/renesas-rpc.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/drivers/mtd/spi-nor/renesas-rpc.c b/drivers/mtd/spi-nor/renesas-rpc.c
index 0026b99effa5..7dc29eaccd7f 100644
--- a/drivers/mtd/spi-nor/renesas-rpc.c
+++ b/drivers/mtd/spi-nor/renesas-rpc.c
@@ -919,7 +919,11 @@ static ssize_t rpc_read_flash(struct spi_nor *nor, loff_t from, size_t len,
 
 	/* ...setup read sequence */
 	val = rpc_read(rpc, DRENR);
-	val |= DRENR_DME | DRENR_CDE;
+	if (nor->read_dummy)
+		val |= DRENR_DME;
+	else
+		val &= ~DRENR_DME;
+	val |= DRENR_CDE;
 	rpc_write(rpc, DRENR, val);
 
 	while (len > 0) {
-- 
2.17.1

