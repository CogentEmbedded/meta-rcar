From cb480163d9cd3ac0ca29ec73da1ca5205885ad9a Mon Sep 17 00:00:00 2001
From: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
Date: Tue, 9 Oct 2018 00:16:57 +0300
Subject: [PATCH] arch: arm64: dts: Add Eagle function ADV7482 dtsi

This replaces max9286 with adv7482 on Eagle function board

Signed-off-by: Nikita Yushchenko <nikita.yoush@cogentembedded.com>
Signed-off-by: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
---
 .../renesas/r8a7797-eagle-function-adv7482.dtsi    | 80 ++++++++++++++++++++++
 .../boot/dts/renesas/r8a7797-eagle-function.dts    |  5 ++
 2 files changed, 85 insertions(+)
 create mode 100644 arch/arm64/boot/dts/renesas/r8a7797-eagle-function-adv7482.dtsi

diff --git a/arch/arm64/boot/dts/renesas/r8a7797-eagle-function-adv7482.dtsi b/arch/arm64/boot/dts/renesas/r8a7797-eagle-function-adv7482.dtsi
new file mode 100644
index 0000000..f928210
--- /dev/null
+++ b/arch/arm64/boot/dts/renesas/r8a7797-eagle-function-adv7482.dtsi
@@ -0,0 +1,80 @@
+/*
+ * Device Tree Source for the Eagle Function board on r8a7797
+ *  this adding conflicting resource on CSI2_40/VIN0
+ *  use ADV7482 instead default MAX9286
+ *
+ * Copyright (C) 2018 Renesas Electronics Corp.
+ * Copyright (C) 2018 Cogent Embedded, Inc.
+ *
+ * This file is licensed under the terms of the GNU General Public License
+ * version 2.  This program is licensed "as is" without any warranty of any
+ * kind, whether express or implied.
+ */
+
+&i2c3 {
+	ov106xx@0 {
+		status = "disabled";
+	};
+	ov106xx@1 {
+		status = "disabled";
+	};
+	ov106xx@2 {
+		status = "disabled";
+	};
+	ov106xx@3 {
+		status = "disabled";
+	};
+	max9286@0 {
+		status = "disabled";
+	};
+};
+
+&i2c0 {
+	hdmirx@70 {
+		compatible = "adi,adv7482";
+		reg = <0x70>;
+
+		adi,input-interface = "rgb888";
+		adi,input-hdmi = "on";
+		adi,input-sdp = "on";
+		adi,sw-reset = "on";
+		adi,virtual-channel = <0>;
+
+		port {
+			hdmirx_ep: endpoint {
+				clock-lanes = <0>;
+				data-lanes = <1 2 3 4>;
+				remote-endpoint = <&vin0ep0>;
+			};
+		};
+	};
+};
+
+&vin0ep0 {
+	remote-endpoint = <&hdmirx_ep>;
+};
+
+&vin1 {
+	status = "disabled";
+};
+&vin2 {
+	status = "disabled";
+};
+&vin3 {
+	status = "disabled";
+};
+
+&csi2_40_ep {
+	/*
+	 * https://linuxtv.org/downloads/v4l-dvb-apis/kapi/csi2.html
+	 * link_freq = (pixel_rate * bits_per_sample) / (2 * nr_of_lanes)
+	 * bps = link_freq * 2
+	 * RGB888: bps = pixel_rate * 24 / (2 * 4) * 2 = pixel_rate * 6
+	 *
+	 * 800x600@60 -> mbps = 40 * 6 = 250
+	 * 1600x1200@60 -> mbps = 162 * 6 = 950
+	 * 1920x1080@60 -> mbps = 148.5 * 6 = 900
+	 * See Documentation/EDID/ for pixel_rate values
+	 */
+	csi-rate = <900>;
+};
diff --git a/arch/arm64/boot/dts/renesas/r8a7797-eagle-function.dts b/arch/arm64/boot/dts/renesas/r8a7797-eagle-function.dts
index 82d6513..eade4d0 100644
--- a/arch/arm64/boot/dts/renesas/r8a7797-eagle-function.dts
+++ b/arch/arm64/boot/dts/renesas/r8a7797-eagle-function.dts
@@ -60,3 +60,8 @@
 	non-removable;
 	status = "okay";
 };
+
+
+#include "r8a7797-eagle-function-adv7482.dtsi"
+
+
-- 
1.9.1

