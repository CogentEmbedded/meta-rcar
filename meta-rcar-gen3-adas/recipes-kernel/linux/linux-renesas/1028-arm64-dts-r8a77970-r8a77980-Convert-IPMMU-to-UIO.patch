From c84daaf23287a1148a12a4bc073d97f820a932b7 Mon Sep 17 00:00:00 2001
From: Andrey Dolnikov <andrey.dolnikov@cogentembedded.com>
Date: Fri, 16 Oct 2020 22:58:55 +0300
Subject: [PATCH] arm64: dts: r8a77970, r8a77980: Convert IPMMU to UIO

Signed-off-by: Andrey Dolnikov <andrey.dolnikov@cogentembedded.com>
---
 arch/arm64/boot/dts/renesas/r8a77970.dtsi | 28 ++++++++++++++++++----
 arch/arm64/boot/dts/renesas/r8a77980.dtsi | 40 ++++++++++++++++++++++++-------
 2 files changed, 55 insertions(+), 13 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r8a77970.dtsi b/arch/arm64/boot/dts/renesas/r8a77970.dtsi
index 10a5b8f..a85afce 100644
--- a/arch/arm64/boot/dts/renesas/r8a77970.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a77970.dtsi
@@ -1201,44 +1201,62 @@
 		};
 
 		ipmmu_ds1: mmu@e7740000 {
-			compatible = "renesas,ipmmu-r8a77970";
+			compatible = "renesas,ipmmu-r8a77970",
+				     "generic-uio";
 			reg = <0 0xe7740000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 0>;
 			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_DS1>;
 		};
 
 		ipmmu_ir: mmu@ff8b0000 {
-			compatible = "renesas,ipmmu-r8a77970";
+			compatible = "renesas,ipmmu-r8a77970",
+				     "generic-uio";
 			reg = <0 0xff8b0000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 3>;
 			power-domains = <&sysc R8A77970_PD_A3IR>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_IR>;
 		};
 
 		ipmmu_mm: mmu@e67b0000 {
-			compatible = "renesas,ipmmu-r8a77970";
+			compatible = "renesas,ipmmu-r8a77970",
+				     "generic-uio";
 			reg = <0 0xe67b0000 0 0x1000>;
 			interrupts = <GIC_SPI 196 IRQ_TYPE_LEVEL_HIGH>,
 				     <GIC_SPI 197 IRQ_TYPE_LEVEL_HIGH>;
 			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_MM>;
+		};
+
+		irq_ipmmu_mm_01 {
+			compatible = "generic-uio";
+			reg = <0 0xe67b0000 0 0x1000>;
+			interrupts = <GIC_SPI 197 IRQ_TYPE_LEVEL_HIGH>;
+			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
+			ipmmu-id = <RCAR_IPMMU_MM>;
 		};
 
 		ipmmu_rt: mmu@ffc80000 {
-			compatible = "renesas,ipmmu-r8a77970";
+			compatible = "renesas,ipmmu-r8a77970",
+				     "generic-uio";
 			reg = <0 0xffc80000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 7>;
 			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_RT>;
 		};
 
 		ipmmu_vi0: mmu@febd0000 {
-			compatible = "renesas,ipmmu-r8a77970";
+			compatible = "renesas,ipmmu-r8a77970",
+				     "generic-uio";
 			reg = <0 0xfebd0000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 9>;
 			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_VI0>;
 		};
 
 		mmc0: mmc@ee140000 {
diff --git a/arch/arm64/boot/dts/renesas/r8a77980.dtsi b/arch/arm64/boot/dts/renesas/r8a77980.dtsi
index f73f03b..8d2b5a3 100644
--- a/arch/arm64/boot/dts/renesas/r8a77980.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a77980.dtsi
@@ -1796,66 +1796,90 @@
 		};
 
 		ipmmu_ds1: mmu@e7740000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xe7740000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 0>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_DS1>;
 		};
 
 		ipmmu_ir: mmu@ff8b0000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xff8b0000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 3>;
 			power-domains = <&sysc R8A77980_PD_A3IR>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_IR>;
 		};
 
 		ipmmu_mm: mmu@e67b0000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xe67b0000 0 0x1000>;
 			interrupts = <GIC_SPI 196 IRQ_TYPE_LEVEL_HIGH>,
 				     <GIC_SPI 197 IRQ_TYPE_LEVEL_HIGH>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_MM>;
+		};
+
+		irq_ipmmu_mm_01 {
+			compatible = "generic-uio";
+			reg = <0 0xe67b0000 0 0x1000>;
+			interrupts = <GIC_SPI 197 IRQ_TYPE_LEVEL_HIGH>;
+			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
+			ipmmu-id = <RCAR_IPMMU_MM>;
 		};
 
 		ipmmu_rt: mmu@ffc80000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xffc80000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 10>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_RT>;
 		};
 
 		ipmmu_vc0: mmu@fe6b0000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xfe6b0000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 12>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_VC0>;
 		};
 
 		ipmmu_vi0: mmu@febd0000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xfebd0000 0 0x1000>;
 			renesas,ipmmu-main = <&ipmmu_mm 14>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_VI0>;
 		};
 
 		ipmmu_vip0: mmu@e7b00000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xe7b00000 0 0x1000>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_VIP0>;
 		};
 
 		ipmmu_vip1: mmu@e7960000 {
-			compatible = "renesas,ipmmu-r8a77980";
+			compatible = "renesas,ipmmu-r8a77980",
+				     "generic-uio";
 			reg = <0 0xe7960000 0 0x1000>;
 			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
 			#iommu-cells = <1>;
+			ipmmu-id = <RCAR_IPMMU_VIP1>;
 		};
 
 		mmc0: mmc@ee140000 {
-- 
2.7.4

