From e398e4bef13763dbe64eefe1d62b693834851cd9 Mon Sep 17 00:00:00 2001
From: Vladimir Barinov <vladimir.barinov@cogentembedded.com>
Date: Wed, 19 Sep 2018 07:32:52 +0300
Subject: [PATCH] arm64: renesas: r8a7798: use CSI 4 lanes

H/w must use 4 lanes
add PWM for external FSIN on deserializers
---
 .../boot/dts/renesas/r8a7798-v3hsk-vb-4ch.dts      | 60 ++++---------------
 .../boot/dts/renesas/r8a7798-v3hsk-vb-8ch.dts      | 69 +++++++---------------
 2 files changed, 32 insertions(+), 97 deletions(-)

diff --git a/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-4ch.dts b/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-4ch.dts
index a53bc8d..e0099a6 100644
--- a/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-4ch.dts
+++ b/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-4ch.dts
@@ -107,32 +107,13 @@
 &csi2_40 {
 	status = "okay";
 
-	virtual,channel {
-		csi2_vc0 {
-			data,type = "ycbcr422";
-			receive,vc = <0>;
-		};
-		csi2_vc1 {
-			data,type = "ycbcr422";
-			receive,vc = <1>;
-		};
-		csi2_vc2 {
-			data,type = "ycbcr422";
-			receive,vc = <2>;
-		};
-		csi2_vc3 {
-			data,type = "ycbcr422";
-			receive,vc = <3>;
-		};
-	};
-
 	port {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
 		csi2_40_ep: endpoint {
 			clock-lanes = <0>;
-			data-lanes = <1 2 3>;
+			data-lanes = <1 2 3 4>;
 			csi-rate = <1450>;
 		};
 	};
@@ -141,32 +122,13 @@
 &csi2_41 {
 	status = "okay";
 
-	virtual,channel {
-		csi2_vc0 {
-			data,type = "ycbcr422";
-			receive,vc = <0>;
-		};
-		csi2_vc1 {
-			data,type = "ycbcr422";
-			receive,vc = <1>;
-		};
-		csi2_vc2 {
-			data,type = "ycbcr422";
-			receive,vc = <2>;
-		};
-		csi2_vc3 {
-			data,type = "ycbcr422";
-			receive,vc = <3>;
-		};
-	};
-
 	port {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
 		csi2_41_ep: endpoint {
 			clock-lanes = <0>;
-			data-lanes = <1 2 3>;
+			data-lanes = <1 2 3 4>;
 			csi-rate = <1450>;
 		};
 	};
@@ -200,7 +162,7 @@
 				port@0 {
 					ov106xx_in0: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin0ep0>;
 					};
 				};
@@ -218,7 +180,7 @@
 				port@0 {
 					ov106xx_in1: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin1ep0>;
 					};
 				};
@@ -236,7 +198,7 @@
 				port@0 {
 					ov106xx_in2: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin6ep0>;
 					};
 				};
@@ -254,7 +216,7 @@
 				port@0 {
 					ov106xx_in3: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin7ep0>;
 					};
 				};
@@ -271,7 +233,7 @@
 				clock-names = "ref_clk";
 				reg = <0x3a>;
 				ti,links = <4>;
-				ti,lanes = <3>;
+				ti,lanes = <4>;
 				ti,forwarding-mode = "round-robin";
 				ti,cable-mode = "coax";
 				gpios = <&gpio_exp_ch0 13 GPIO_ACTIVE_LOW>;
@@ -558,7 +520,7 @@
 			vin0ep0: endpoint {
 				csi,select = "csi40";
 				virtual,channel = <0>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in0>;
 			};
 		};
@@ -586,7 +548,7 @@
 			vin1ep0: endpoint {
 				csi,select = "csi40";
 				virtual,channel = <1>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in1>;
 			};
 		};
@@ -614,7 +576,7 @@
 			vin6ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <2>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in2>;
 			};
 		};
@@ -642,7 +604,7 @@
 			vin7ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <3>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in3>;
 			};
 		};
diff --git a/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-8ch.dts b/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-8ch.dts
index 24411e1..79d210b 100644
--- a/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-8ch.dts
+++ b/arch/arm64/boot/dts/renesas/r8a7798-v3hsk-vb-8ch.dts
@@ -107,25 +107,6 @@
 &csi2_40 {
 	status = "okay";
 
-	virtual,channel {
-		csi2_vc0 {
-			data,type = "ycbcr422";
-			receive,vc = <0>;
-		};
-		csi2_vc1 {
-			data,type = "ycbcr422";
-			receive,vc = <1>;
-		};
-		csi2_vc2 {
-			data,type = "ycbcr422";
-			receive,vc = <2>;
-		};
-		csi2_vc3 {
-			data,type = "ycbcr422";
-			receive,vc = <3>;
-		};
-	};
-
 	port {
 		#address-cells = <1>;
 		#size-cells = <0>;
@@ -141,32 +122,13 @@
 &csi2_41 {
 	status = "okay";
 
-	virtual,channel {
-		csi2_vc0 {
-			data,type = "ycbcr422";
-			receive,vc = <0>;
-		};
-		csi2_vc1 {
-			data,type = "ycbcr422";
-			receive,vc = <1>;
-		};
-		csi2_vc2 {
-			data,type = "ycbcr422";
-			receive,vc = <2>;
-		};
-		csi2_vc3 {
-			data,type = "ycbcr422";
-			receive,vc = <3>;
-		};
-	};
-
 	port {
 		#address-cells = <1>;
 		#size-cells = <0>;
 
 		csi2_41_ep: endpoint {
 			clock-lanes = <0>;
-			data-lanes = <1 2 3>;
+			data-lanes = <1 2 3 4>;
 			csi-rate = <1450>;
 		};
 	};
@@ -358,7 +320,7 @@
 				port@0 {
 					ov106xx_in4: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin4ep0>;
 					};
 				};
@@ -376,7 +338,7 @@
 				port@0 {
 					ov106xx_in5: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin5ep0>;
 					};
 				};
@@ -394,7 +356,7 @@
 				port@0 {
 					ov106xx_in6: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin6ep0>;
 					};
 				};
@@ -412,7 +374,7 @@
 				port@0 {
 					ov106xx_in7: endpoint {
 						clock-lanes = <0>;
-						data-lanes = <1 2 3>;
+						data-lanes = <1 2 3 4>;
 						remote-endpoint = <&vin7ep0>;
 					};
 				};
@@ -429,7 +391,7 @@
 				clock-names = "ref_clk";
 				reg = <0x3a>;
 				ti,links = <4>;
-				ti,lanes = <3>;
+				ti,lanes = <4>;
 				ti,forwarding-mode = "round-robin";
 				ti,cable-mode = "coax";
 				gpios = <&gpio_exp_ch1 13 GPIO_ACTIVE_LOW>;
@@ -681,12 +643,23 @@
 		function = "i2c1";
 	};
 
+	pwm0_pins: pwm0 {
+		groups = "pwm0_a";
+		function = "pwm0";
+	};
+
 	scif3_pins: scif3 {
 		groups = "scif3_data";
 		function = "scif3";
 	};
 };
 
+&pwm0 {
+	pinctrl-0 = <&pwm0_pins>;
+	pinctrl-names = "default";
+	status = "okay";
+};
+
 &scif3 {
 	pinctrl-0 = <&scif3_pins>;
 	pinctrl-names = "default";
@@ -821,7 +794,7 @@
 			vin4ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <0>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in4>;
 			};
 		};
@@ -849,7 +822,7 @@
 			vin5ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <1>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in5>;
 			};
 		};
@@ -877,7 +850,7 @@
 			vin6ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <2>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in6>;
 			};
 		};
@@ -905,7 +878,7 @@
 			vin7ep0: endpoint {
 				csi,select = "csi41";
 				virtual,channel = <3>;
-				data-lanes = <1 2 3>;
+				data-lanes = <1 2 3 4>;
 				remote-endpoint = <&ov106xx_in7>;
 			};
 		};
-- 
1.9.1

