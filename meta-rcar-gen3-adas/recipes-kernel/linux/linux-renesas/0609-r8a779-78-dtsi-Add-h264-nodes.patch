From 6af3c775b9358a1e6ad4c09859730106f56229b3 Mon Sep 17 00:00:00 2001
From: Andrey Dolnikov <andrey.dolnikov@cogentembedded.com>
Date: Thu, 2 Jul 2020 19:13:06 +0300
Subject: [PATCH] r8a779[78]: dtsi: Add h264 nodes

---
 arch/arm64/boot/dts/renesas/r8a77970.dtsi | 16 ++++++++++++++++
 arch/arm64/boot/dts/renesas/r8a77980.dtsi | 16 ++++++++++++++++
 drivers/clk/renesas/r8a77980-cpg-mssr.c   |  1 +
 3 files changed, 33 insertions(+)

diff --git a/arch/arm64/boot/dts/renesas/r8a77970.dtsi b/arch/arm64/boot/dts/renesas/r8a77970.dtsi
index bbd40a1..170cece 100644
--- a/arch/arm64/boot/dts/renesas/r8a77970.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a77970.dtsi
@@ -1363,6 +1363,22 @@
 			compatible = "renesas,qos";
 			reg = <0 0xe67e0000 0 0x10090>;
 		};
+
+		h264_ch0 {
+			compatible = "generic-uio";
+			reg = <0 0xfea00000 0 0x10000>;
+			clocks = <&cpg CPG_MOD 127>;
+			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
+			interrupts = <GIC_SPI 300 IRQ_TYPE_LEVEL_HIGH>;
+		};
+
+		h264_ch1 {
+			compatible = "generic-uio";
+			reg = <0 0xfea00000 0 0x10000>;
+			clocks = <&cpg CPG_MOD 127>;
+			power-domains = <&sysc R8A77970_PD_ALWAYS_ON>;
+			interrupts = <GIC_SPI 170 IRQ_TYPE_LEVEL_HIGH>;
+		};
 	};
 
 	thermal-zones {
diff --git a/arch/arm64/boot/dts/renesas/r8a77980.dtsi b/arch/arm64/boot/dts/renesas/r8a77980.dtsi
index 10e1064..a807ceb 100644
--- a/arch/arm64/boot/dts/renesas/r8a77980.dtsi
+++ b/arch/arm64/boot/dts/renesas/r8a77980.dtsi
@@ -1950,6 +1950,22 @@
 			compatible = "renesas,qos";
 			reg = <0 0xe67e0000 0 0x10090>;
 		};
+
+		h264_ch0 {
+			compatible = "generic-uio";
+			reg = <0 0xfea00000 0 0x10000>;
+			clocks = <&cpg CPG_MOD 127>;
+			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
+			interrupts = <GIC_SPI 300 IRQ_TYPE_LEVEL_HIGH>;
+		};
+
+		h264_ch1 {
+			compatible = "generic-uio";
+			reg = <0 0xfea00000 0 0x10000>;
+			clocks = <&cpg CPG_MOD 127>;
+			power-domains = <&sysc R8A77980_PD_ALWAYS_ON>;
+			interrupts = <GIC_SPI 170 IRQ_TYPE_LEVEL_HIGH>;
+		};
 	};
 
 	thermal-zones {
diff --git a/drivers/clk/renesas/r8a77980-cpg-mssr.c b/drivers/clk/renesas/r8a77980-cpg-mssr.c
index 4a61b585..04ffe14 100644
--- a/drivers/clk/renesas/r8a77980-cpg-mssr.c
+++ b/drivers/clk/renesas/r8a77980-cpg-mssr.c
@@ -119,6 +119,7 @@ static const struct mssr_mod_clk r8a77980_mod_clks[] __initconst = {
 	DEF_MOD("tmu2",			 123,	R8A77980_CLK_S0D6),
 	DEF_MOD("tmu1",			 124,	R8A77980_CLK_S0D6),
 	DEF_MOD("tmu0",			 125,	R8A77980_CLK_CP),
+	DEF_MOD("ivcp1e",		 127,	R8A77980_CLK_S2D1),
 	DEF_MOD("scif4",		 203,	R8A77980_CLK_S3D4),
 	DEF_MOD("scif3",		 204,	R8A77980_CLK_S3D4),
 	DEF_MOD("scif1",		 206,	R8A77980_CLK_S3D4),
-- 
2.7.4

